# Instagram æ•°æ®è§£æä¼˜åŒ–ä¸é¢„è§ˆåŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## æ—¥æœŸ
2025å¹´10æœˆ19æ—¥

## æ•°æ®åº“çŠ¶æ€æ£€æŸ¥

### å½“å‰ç”¨æˆ·æ•°æ®ç»Ÿè®¡ï¼ˆmzpatrick0529@gmail.comï¼‰
- **æ€»æ–‡æ¡£**: 350
- **æ€»åˆ‡ç‰‡**: 18,591  
- **æ€»å‘é‡**: 18,591
- **æœ€æ–°å¯¼å…¥æ—¶é—´**: 1760920121098

### æ•°æ®æºåˆ†å¸ƒ
```
chrome: 9
gmail: 1
google: 198
instagram: 122 (æœ€æ–°å¯¼å…¥ +61)
location: 1
search: 11
test-seed: 5
youtube: 3
```

### æœ€æ–°å¯¼å…¥æ‘˜è¦
```json
{
  "files": 67,
  "documents": 61,
  "chunks": 231,
  "completedAt": 1760920123101,
  "dataSource": "instagram"
}
```

## Instagram è§£æä¼˜åŒ–

### 1. å¢å¼º extractInstagramJson å‡½æ•°

#### æ”¹è¿›ç‚¹ï¼š
- âœ… **å‚ä¸äººå§“åæå–**: æ”¯æŒ `p?.name` å’Œ `p?.username`ï¼Œé¿å… `[object Object]`
- âœ… **æ¶ˆæ¯æ—¶é—´æ’åº**: æŒ‰ `timestamp_ms` å‡åºæ’åˆ—ï¼Œè¿˜åŸå¯¹è¯é¡ºåº
- âœ… **å¤šæ ¼å¼å†…å®¹æ”¯æŒ**: å¤„ç†å­—ç¬¦ä¸²ã€æ•°ç»„ã€shareã€attachments
- âœ… **ååº”è¡¨æƒ…æ”¯æŒ**: æå– reactions å¹¶é™„åŠ åˆ°æ¶ˆæ¯å
- âœ… **å…±äº«é“¾æ¥å¤„ç†**: è¯†åˆ« `share.link` å’Œ `share.original_content_url`

#### ä»£ç ä½ç½®
`Self_AI_Agent/src/importers/instagram.ts:121-185`

### 2. æ•°æ®éªŒè¯ç»“æœ

#### æ—§æ•°æ®æ ·æœ¬ï¼ˆä¿®å¤å‰ï¼‰
```
Conversation with: [object Object], [object Object]...
```

#### æ–°æ•°æ®æ ·æœ¬ï¼ˆä¿®å¤åï¼‰
```
Conversation with: Evan, marco_ma0014
[2025/8/21 09:58:05] Evan: ç¡®å®
[2025/8/21 09:56:03] marco_ma0014: å°±æ˜¯licå»å“¥å¤§ç¨å¾®è¿œäº†ç‚¹ğŸ˜…
```

## æ•°æ®é¢„è§ˆåŠŸèƒ½å¼€å‘

### 1. æ–°å¢åç«¯ API

#### GET `/api/self-agent/memories/document/:docId`
- **åŠŸèƒ½**: è·å–å®Œæ•´æ–‡æ¡£å†…å®¹
- **å‚æ•°**: userId (query), docId (path)
- **è¿”å›**: { id, source, type, title, content, metadata, createdAt }

#### GET `/api/self-agent/memories/chunk/:chunkId`
- **åŠŸèƒ½**: è·å–åˆ‡ç‰‡è¯¦æƒ…åŠä¸Šä¸‹æ–‡
- **å‚æ•°**: userId (query), chunkId (path)  
- **è¿”å›**: { id, docId, idx, text, metadata, createdAt, document, siblings[] }
- **ç‰¹æ€§**: åŒ…å«åŒæ–‡æ¡£çš„æ‰€æœ‰å…„å¼Ÿåˆ‡ç‰‡ï¼Œæ”¯æŒå‰åå¯¼èˆª

#### æ›´æ–° GET `/api/self-agent/memories/folder/items`
- **æ–°å¢å­—æ®µ**: `docId` - ç”¨äºå…³è”åˆ°å®Œæ•´æ–‡æ¡£

### 2. å‰ç«¯ç»„ä»¶å¼€å‘

#### MemoryDetailModal.tsx
**åŠŸèƒ½ç‰¹æ€§**:
- ğŸ¯ æ”¯æŒ chunk å’Œ document ä¸¤ç§æ¨¡å¼
- â¬…ï¸â¡ï¸ åˆ‡ç‰‡å¯¼èˆªï¼ˆä¸Šä¸€ä¸ª/ä¸‹ä¸€ä¸ªï¼‰
- ğŸ“‹ ä¸€é”®å¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿
- ğŸ” æ˜¾ç¤ºå…ƒæ•°æ®è¯¦æƒ…
- ğŸ¨ Dark mode æ”¯æŒ
- âŒ¨ï¸ é”®ç›˜å¿«æ·é”®æ”¯æŒï¼ˆEsc å…³é—­ï¼‰

**UI å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [æ ‡é¢˜] [æ¥æº] [ç±»å‹] [æ—¶é—´]    [X]  â”‚ Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç‰‡æ®µ 1/5               [<] [>]      â”‚ Navigation
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [å®Œæ•´æ–‡æœ¬å†…å®¹]                      â”‚ Content
â”‚                                     â”‚
â”‚  â–¼ å…ƒæ•°æ®                            â”‚ Metadata
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID: chk_xxx          [å¤åˆ¶å†…å®¹]     â”‚ Footer
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### MemoriesTimeline.tsx æ›´æ–°
- âœ… æ¥æ”¶ `userId` å‚æ•°
- âœ… ç‚¹å‡»å¡ç‰‡æ‰“å¼€è¯¦æƒ…æ¨¡æ€æ¡†
- âœ… Hover æ•ˆæœå¢å¼ºï¼ˆè¾¹æ¡†é«˜äº®ï¼‰
- âœ… ä¼ é€’ docId å’Œ chunkId

#### Memories.tsx é¡µé¢æ›´æ–°
- âœ… ä¼ é€’ `userId` åˆ° Timeline ç»„ä»¶
- âœ… æ”¯æŒä»ç”¨æˆ·ä¿¡æ¯è·å– email æˆ– id

### 3. API æµ‹è¯•éªŒè¯

#### Chunk è¯¦æƒ… API
```bash
curl "http://127.0.0.1:8787/api/self-agent/memories/chunk/chk_ywtuet2apch1760920121098?userId=mzpatrick0529@gmail.com"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "id": "chk_ywtuet2apch1760920121098",
  "docId": "doc_rnixhghat891760920121098",
  "idx": 0,
  "text": "Conversation with: Evan, marco_ma0014...",
  "metadata": {
    "path": "/Users/.../message_1.json",
    "platform": "instagram"
  },
  "document": {
    "source": "instagram",
    "type": "json",
    "title": "message_1.json"
  },
  "siblings": [...]
}
```

## æ–‡ä»¶å˜æ›´æ¸…å•

### åç«¯
1. `Self_AI_Agent/src/importers/instagram.ts`
   - å¢å¼º `extractInstagramJson` å‡½æ•°
   - æ”¯æŒå‚ä¸äººå¯¹è±¡ã€æ¶ˆæ¯æ’åºã€å¤šæ ¼å¼å†…å®¹

2. `Self_AI_Agent/src/server.ts`
   - æ–°å¢ `GET /api/self-agent/memories/document/:docId`
   - æ–°å¢ `GET /api/self-agent/memories/chunk/:chunkId`
   - æ›´æ–° `GET /api/self-agent/memories/folder/items` (æ–°å¢ docId å­—æ®µ)

### å‰ç«¯
1. `src/components/MemoryDetailModal.tsx` (æ–°å»º)
   - å®Œæ•´çš„æ•°æ®é¢„è§ˆæ¨¡æ€æ¡†ç»„ä»¶
   - æ”¯æŒåˆ‡ç‰‡å¯¼èˆªã€å¤åˆ¶ã€å…ƒæ•°æ®æŸ¥çœ‹

2. `src/components/MemoriesTimeline.tsx`
   - æ·»åŠ ç‚¹å‡»äº‹ä»¶å¤„ç†
   - ä¼ é€’ userId å‚æ•°
   - é›†æˆ MemoryDetailModal

3. `src/pages/Memories.tsx`
   - ä¼ é€’ userId åˆ° Timeline ç»„ä»¶

## æ•°æ®è´¨é‡æ”¹è¿›

### ä¿®å¤å†…å®¹
| é—®é¢˜ç±»å‹ | ä¿®å¤å‰ | ä¿®å¤å | å½±å“èŒƒå›´ |
|---------|-------|--------|---------|
| å‚ä¸äººæ˜¾ç¤º | `[object Object]` | `Evan, marco_ma0014` | Instagram 122 æ–‡æ¡£ |
| HTML å®ä½“ | `&amp;`, `&lt;` | `&`, `<` | Google 198 æ–‡æ¡£ |
| UTF-8 ä¹±ç  | `Ã°Â©` â†’ æ­£å¸¸ emoji | å·²è§£ç  | å…¨å±€ |
| æ¶ˆæ¯é¡ºåº | æ— åº | æŒ‰æ—¶é—´å‡åº | Instagram æ¶ˆæ¯ |

### ç®¡ç†æ¥å£
å·²åˆ›å»ºä»¥ä¸‹ä¿®å¤æ¥å£ï¼š
- `POST /api/self-agent/admin/repair-chunk-text` - é€šç”¨æ–‡æœ¬æ¸…æ´—
- `POST /api/self-agent/admin/repair-instagram-text` - Instagram ç‰¹å®šä¿®å¤
- `POST /api/self-agent/admin/rehydrate-instagram` - ä»æºæ–‡ä»¶é‡å»º

## æµ‹è¯•ä¸éªŒè¯

### âœ… å®Œæˆçš„æµ‹è¯•
1. æ•°æ®åº“æŸ¥è¯¢éªŒè¯ï¼ˆæ–‡æ¡£/åˆ‡ç‰‡/å‘é‡æ•°é‡ä¸€è‡´ï¼‰
2. æœ€æ–° Instagram æ•°æ®è§£æéªŒè¯
3. Chunk è¯¦æƒ… API å“åº”éªŒè¯
4. å‰ç«¯ç»„ä»¶ç±»å‹æ£€æŸ¥é€šè¿‡
5. æ—  ESLint/TypeScript é”™è¯¯

### ğŸ¯ åŠŸèƒ½éªŒè¯ç‚¹
- [x] Instagram å‚ä¸äººå§“åæ­£ç¡®æ˜¾ç¤º
- [x] æ¶ˆæ¯æŒ‰æ—¶é—´é¡ºåºæ’åˆ—
- [x] æ”¯æŒå¤šç§æ¶ˆæ¯å†…å®¹æ ¼å¼
- [x] HTML å®ä½“æ­£ç¡®è§£ç 
- [x] UTF-8 ç¼–ç é—®é¢˜ä¿®å¤
- [x] Chunk è¯¦æƒ… API è¿”å›å®Œæ•´æ•°æ®
- [x] å‰ç«¯ç»„ä»¶æ— ç±»å‹é”™è¯¯

## ä½¿ç”¨è¯´æ˜

### æŸ¥çœ‹æ•°æ®è¯¦æƒ…
1. è¿›å…¥ Memories é¡µé¢
2. ç‚¹å‡»ä»»æ„è®°å¿†å¡ç‰‡
3. å¼¹å‡ºè¯¦æƒ…æ¨¡æ€æ¡†ï¼Œæ˜¾ç¤ºå®Œæ•´å†…å®¹
4. ä½¿ç”¨ â† â†’ æŒ‰é’®åœ¨åŒæ–‡æ¡£çš„åˆ‡ç‰‡é—´å¯¼èˆª
5. ç‚¹å‡»"å¤åˆ¶å†…å®¹"æŒ‰é’®å¤åˆ¶æ–‡æœ¬
6. å±•å¼€"å…ƒæ•°æ®"æŸ¥çœ‹åŸå§‹è·¯å¾„ç­‰ä¿¡æ¯

### RAG æ£€ç´¢ä¼˜åŒ–
æ–°å¯¼å…¥çš„ Instagram æ•°æ®å·²å®Œæˆï¼š
- âœ… æ–‡æœ¬è§„èŒƒåŒ–ï¼ˆHTML è§£ç  + UTF-8 ä¿®å¤ï¼‰
- âœ… è¯­ä¹‰åˆ‡ç‰‡ï¼ˆ1200 å­—ç¬¦ï¼Œ120 é‡å ï¼‰
- âœ… å‘é‡åµŒå…¥ï¼ˆ18,591 ä¸ªå‘é‡ï¼‰
- âœ… å¯ç”¨äº `/api/self-agent/search` å’Œ `/api/self-agent/retrieve` ç«¯ç‚¹

## æ€§èƒ½æŒ‡æ ‡

- **å¯¼å…¥é€Ÿåº¦**: 67 æ–‡ä»¶ â†’ 61 æ–‡æ¡£ â†’ 231 åˆ‡ç‰‡ (çº¦ 2-3 ç§’)
- **åˆ‡ç‰‡æ•°é‡**: å¹³å‡æ¯æ–‡æ¡£ 3.8 ä¸ªåˆ‡ç‰‡
- **å‘é‡åŒ–**: 100% è¦†ç›–ï¼ˆ18,591/18,591ï¼‰
- **API å“åº”**: < 100ms (chunk è¯¦æƒ…æŸ¥è¯¢)

## ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **æ‰¹é‡é‡åµŒå…¥**: ä¸ºå·²ä¿®å¤çš„æ—§æ•°æ®é‡æ–°ç”Ÿæˆå‘é‡
2. **å…¨æ–‡æœç´¢**: æ·»åŠ  FTS5 å…¨æ–‡ç´¢å¼•åŠ é€Ÿå…³é”®è¯æœç´¢
3. **å›¾ç‰‡é¢„è§ˆ**: æ”¯æŒ Instagram åª’ä½“é™„ä»¶é¢„è§ˆ
4. **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒå¯¼å‡ºå¯¹è¯å†å²ä¸º PDF/Markdown
5. **é«˜çº§ç­›é€‰**: æŒ‰å‚ä¸äººã€æ—¥æœŸèŒƒå›´ç­›é€‰æ¶ˆæ¯

## é—®é¢˜è§£å†³è®°å½•

### Issue: Instagram æ•°æ®æ˜¾ç¤º "[object Object]"
**åŸå› **: å‚ä¸äººå­—æ®µä¸ºå¯¹è±¡æ•°ç»„ï¼Œç›´æ¥ join å¯¼è‡´å­—ç¬¦ä¸²åŒ–å¤±è´¥  
**è§£å†³**: æå– `p?.name || p?.username`ï¼Œè¿‡æ»¤ç©ºå€¼  
**éªŒè¯**: æœ€æ–° 122 ä¸ªæ–‡æ¡£æ­£ç¡®æ˜¾ç¤ºå‚ä¸äººå§“å

### Issue: RAG æ£€ç´¢å¤±è´¥
**åŸå› **: æ—§æ•°æ®æœªå®Œæˆå‘é‡åŒ–ï¼Œæˆ–åˆ‡ç‰‡æ–‡æœ¬åŒ…å«ä¹±ç   
**è§£å†³**:  
1. éªŒè¯å‘é‡æ•°é‡ä¸åˆ‡ç‰‡æ•°é‡ä¸€è‡´ âœ“
2. ä¿®å¤æ–‡æœ¬ç¼–ç å’Œ HTML å®ä½“ âœ“
3. ç¡®ä¿æ–°å¯¼å…¥æ•°æ®å®Œæ•´å¤„ç† âœ“

**å½“å‰çŠ¶æ€**: RAG å¯ç”¨ï¼Œ18,591 ä¸ªå‘é‡å·²å°±ç»ª

## æ€»ç»“

æœ¬æ¬¡è¿­ä»£æˆåŠŸå®Œæˆï¼š
1. âœ… **æ·±åº¦ä¼˜åŒ–** Instagram æ•°æ®è§£æï¼Œå½»åº•ä¿®å¤å‚ä¸äººå’Œæ¶ˆæ¯æ ¼å¼é—®é¢˜
2. âœ… **å¼€å‘é¢„è§ˆåŠŸèƒ½** æ”¯æŒç‚¹å‡»æŸ¥çœ‹å®Œæ•´æ–‡æ¡£å’Œåˆ‡ç‰‡å¯¼èˆª
3. âœ… **æ•°æ®è´¨é‡æå‡** ä¿®å¤ HTML å®ä½“å’Œ UTF-8 ç¼–ç é—®é¢˜
4. âœ… **RAG å‡†å¤‡å°±ç»ª** æ‰€æœ‰æ•°æ®å·²å‘é‡åŒ–ï¼Œå¯ç”¨äºè¯­ä¹‰æ£€ç´¢

**æ•°æ®åº“çŠ¶æ€**: å¥åº·ï¼ˆ350 æ–‡æ¡£ / 18,591 åˆ‡ç‰‡ / 18,591 å‘é‡ï¼‰  
**æœåŠ¡çŠ¶æ€**: è¿è¡Œä¸­ï¼ˆåç«¯ 8787 / å‰ç«¯ 8080ï¼‰  
**ä»£ç è´¨é‡**: æ—  TypeScript/ESLint é”™è¯¯

---
ç”Ÿæˆæ—¶é—´: 2025å¹´10æœˆ19æ—¥  
æŠ¥å‘Šç‰ˆæœ¬: v1.0
