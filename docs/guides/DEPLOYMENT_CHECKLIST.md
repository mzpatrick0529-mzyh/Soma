# ✅ 生产环境部署检查清单

在部署到生产环境之前，请确保完成以下所有项目：

## 🔐 安全配置

- [ ] **环境变量已设置**
  - [ ] `GEMINI_API_KEY` 已配置且有效
  - [ ] `GOOGLE_CLIENT_ID` 已配置
  - [ ] `GOOGLE_CLIENT_SECRET` 已配置
  - [ ] `JWT_SECRET` 已设置（至少32位随机字符串）
  - [ ] 所有密钥未硬编码在代码中

- [ ] **CORS 配置**
  - [ ] 后端允许的源已设置为生产域名
  - [ ] 不允许 `*` 通配符（除非必要）

- [ ] **HTTPS 启用**
  - [ ] 前端使用 HTTPS
  - [ ] 后端使用 HTTPS
  - [ ] Google OAuth 重定向 URI 使用 HTTPS

- [ ] **敏感文件保护**
  - [ ] `.env` 文件已添加到 `.gitignore`
  - [ ] 数据库文件不在公开仓库
  - [ ] API 密钥未暴露在前端代码

## 📦 构建优化

- [ ] **前端优化**
  - [ ] 运行 `npm run build` 成功
  - [ ] 构建产物在 `dist/` 目录
  - [ ] 静态资源压缩启用（Gzip/Brotli）
  - [ ] 图片已优化（WebP 格式）

- [ ] **后端优化**
  - [ ] TypeScript 编译成功
  - [ ] 生产依赖已安装（`npm ci --only=production`）
  - [ ] 日志级别设置为 `info` 或 `warn`

- [ ] **性能优化**
  - [ ] 启用 CDN（Vercel 自动）
  - [ ] 静态资源缓存配置
  - [ ] API 响应缓存（如适用）

## 🌐 网络配置

- [ ] **DNS 设置**
  - [ ] 前端域名 CNAME 记录已添加
  - [ ] 后端域名 CNAME 记录已添加
  - [ ] SSL 证书自动颁发（Vercel/Railway 自动）

- [ ] **API 路由**
  - [ ] `/api` 代理配置正确
  - [ ] OAuth 回调路由可访问
  - [ ] Health check 端点响应正常

## 📊 监控与日志

- [ ] **错误追踪**
  - [ ] Sentry 或类似服务已配置（可选）
  - [ ] 错误日志会被记录
  - [ ] 关键错误有告警通知

- [ ] **性能监控**
  - [ ] Vercel Analytics 已启用（自动）
  - [ ] 后端性能指标可查看
  - [ ] 数据库查询性能可接受

- [ ] **日志管理**
  - [ ] 生产日志可访问（Railway/Render Dashboard）
  - [ ] 敏感信息不会被记录
  - [ ] 日志保留策略已设置

## 🧪 功能测试

- [ ] **核心功能**
  - [ ] 用户注册/登录正常
  - [ ] Google OAuth 登录正常
  - [ ] 数据导入功能正常（Google/Instagram）
  - [ ] AI 聊天功能正常
  - [ ] Memories 展示正常

- [ ] **数据持久化**
  - [ ] SQLite 数据库路径正确
  - [ ] 文件上传存储正常
  - [ ] 向量数据生成正常

- [ ] **响应式设计**
  - [ ] 移动端显示正常
  - [ ] 平板端显示正常
  - [ ] 桌面端显示正常

## 🔍 SEO 优化

- [ ] **元标签**
  - [ ] Title 和 Description 已设置
  - [ ] Open Graph 标签已配置
  - [ ] Twitter Card 已配置

- [ ] **结构化数据**
  - [ ] `robots.txt` 已部署
  - [ ] `sitemap.xml` 已部署
  - [ ] `manifest.json` 已部署（PWA）

- [ ] **搜索引擎提交**
  - [ ] Google Search Console 已提交
  - [ ] Bing Webmaster 已提交（可选）
  - [ ] 百度站长已提交（可选）

## 💾 备份与恢复

- [ ] **数据备份**
  - [ ] SQLite 数据库定期备份计划
  - [ ] 用户上传文件备份计划
  - [ ] 配置文件已保存

- [ ] **灾难恢复**
  - [ ] 数据恢复流程已测试
  - [ ] 回滚计划已准备
  - [ ] 备用部署方案已考虑

## 📱 移动体验

- [ ] **PWA 支持**
  - [ ] Manifest 已配置
  - [ ] Service Worker 已实现（可选）
  - [ ] 添加到主屏幕功能正常

- [ ] **性能**
  - [ ] 首次加载 < 3 秒
  - [ ] Lighthouse 性能分数 > 80
  - [ ] 移动端体验流畅

## 🚀 部署流程

- [ ] **CI/CD 配置**
  - [ ] GitHub Actions 已配置（可选）
  - [ ] 自动部署已启用
  - [ ] 部署前测试已配置

- [ ] **版本管理**
  - [ ] Git tags 用于版本标记
  - [ ] Changelog 已维护
  - [ ] 版本号遵循 SemVer

## 📋 文档完善

- [ ] **用户文档**
  - [ ] README.md 已更新
  - [ ] 部署指南已完成
  - [ ] API 文档已编写（如需对外）

- [ ] **开发者文档**
  - [ ] 环境变量说明清晰
  - [ ] 本地开发指南完整
  - [ ] 贡献指南已添加（如开源）

## 🎯 最终检查

- [ ] **验证脚本通过**
  ```bash
  ./verify-deployment-online.sh https://你的前端域名 https://你的后端域名
  ```

- [ ] **手动浏览测试**
  - [ ] 访问首页正常
  - [ ] 注册/登录流程完整
  - [ ] 核心功能可用
  - [ ] 无控制台错误

- [ ] **性能测试**
  - [ ] Lighthouse 审计通过
  - [ ] WebPageTest 性能可接受
  - [ ] 移动端加载速度正常

---

## ✅ 全部完成？

如果所有检查项都已完成，恭喜你！🎉

你的 Soma 应用已经可以安全地部署到生产环境了。

**下一步**:
1. 运行 `./auto-deploy.sh vercel` 开始部署
2. 或者访问 [Vercel](https://vercel.com) / [Railway](https://railway.app) 手动部署
3. 部署完成后运行验证脚本确认一切正常

**需要帮助？**
查看 [完整部署指南](./DEPLOYMENT_GUIDE.md)
